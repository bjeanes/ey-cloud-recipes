#!/sbin/runscript

# Start/stop script for hudson

PIDFILE=/opt/hudson/tmp/pid
HUDSON_HOME=/opt/hudson/
COMMAND=/usr/bin/java
ARGUMENTS="-Djava.io.tmpdir=/opt/hudson/tmp -jar /opt/hudson/hudson.war --webroot=/opt/hudson/war --httpPort=<%= @port %> ajp13ListenAddress=127.0.0.1"
RUN_AS=<%= @user %>
NAME=Hudson-CI

start() {
  ebegin "Starting $NAME"
  export HUDSON_HOME=/opt/hudson
  start-stop-daemon -b --start --make-pidfile --pidfile $PIDFILE --chuid $RUN_AS --exec $COMMAND -- $ARGUMENTS &>$HUDSON_HOME/logs/hudson_log
  eend $?
}

stop() {
  ebegin "Stopping $NAME"
  start-stop-daemon --stop --quiet --pidfile $PIDFILE
  rm -f $PIDFILE
  eend $?
}